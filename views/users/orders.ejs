<%- include('../include/navigation') %>
  <%- include('../include/header') %>


    <div id="cartfill" class="container">
      <% if(myOrders.length>0) { %>
        <div class="row">
          <div class="col-lg-12 col-xl-12 m-lr-auto m-b-50">
            <div class="m-l-25 m-r--38 m-lr-0-xl">
              <div class="wrap-table-shopping-cart">


                <% myOrders.forEach(order=>{ %>
                  <div class="jumbotron shadow  bg-white rounded p-4 mt-3">
                    <table class="table-shopping-cart">



                      <tr class="table_head">

                        <th class="column-1">Product</th>
                        <th class="column-2"></th>
                        <th class="column-3">Quantity</th>
                        <th class="column-4">Total</th>
                        <th class="column-5">Status</th>
                        <th class="column-5"></th>
                      </tr>

                      <tr class="table_row">
                        <td class="column-1">
                          <div class="">
                            <p> #<%= order._id %>
                            </p>
                          </div>
                          <% order.products.forEach(product=>{%>
                            <a href="/view-one-product/<%=product.productId._id %>"><div class="how-itemcart1 mt-2 ">
                             <img src="/productimages/<%= product.productId.Images[0] %>" alt="IMG">
                            </div></a>


                            <% }) %>
                        </td>
                        <td class="column-2">
                          <div class="d-flex">
                            <% order.products.forEach(product=>{%>
                              <div class="mt-5">
                                <p>
                                  <%= product.productId.Name %>
                                </p>
                              </div>
                          </div>
                          <% }) %>

                        </td>

                        <td class="column-3">
                          <div class="d-flex">
                            <% order.products.forEach(product=>{%>
                              <div class="mt-5">
                                <p class="ml-4">
                                  <%= product.quantity%>
                                </p>
                              </div>
                          </div>
                          <% }) %>
                        </td>
                        <td class="column-4">
                         <p class="ml-5"> â‚¹ <%= order.total %></p>
                        </td>
                        <% if(order.orderActive){ %>
                          <td class="column-5 ">
                            <div class="d-flex flex-row justify-content-between align-items-center align-content-center"
                              id="orderStatusRoad-">
                              <% if(order.status==="placed" ){%>
                                <span class="d-flex justify-content-center align-items-center big-dot dot">
                                  <i class="fa fa-check text-white"></i></span>
                                <h5><span class="badge" style="background-color:rgb(201, 14, 77) ;">
                                    <%= order.status %>
                                  </span></h5>
                                <%}else if(order.status==="Packed" ){ %>
                                  <span class="dot"></span>
                                  <h5> <span class="badge" style="background-color:rgb(91, 12, 38) ;">
                                      <%= order.status %>
                                    </span></h5>
                                  <% }else if(order.status==="Shipped" ){ %>
                                    <span class="dot"></span>
                                    <h5><span class="badge" style="background-color:rgb(244, 138, 0) ;">
                                        <%= order.status %>
                                      </span></h5>
                                    <% }else if(order.status==="Out For Delivery" ){%>
                                      <span class="dot"></span>
                                      <h5><span class="badge ml-5" style="background-color:rgb(77, 1, 255) ;">
                                          <%= order.status %>
                                        </span></h5>
                                      <% }else if(order.status==="Delivered" ){%>
                                        <span class="dot"></span>
                                        <h5><span class="badge specclr" >
                                            <%= order.status %>
                                          </span></h5>
                                        <%}else{ %>
                                          <span class="dot-danger"></span>
                                          <h5> <span class="badge " style="background-color:rgb(177, 39, 85) ;">
                                              <%= order.status %>
                                            </span></h5>
                                          <% } %>


                            </div>

                  </div>
                  </td>
                  <%  if(order.status==="Delivered" ){%>
                  
                    <td class="column-5"><button class="btn btn-outline-dark" disabled><i class="fa-solid fa-thumbs-up specclrText"></i>Delivered</button></td>
                    <% }else{ %>
                  <td class="column-5"><a href="#" onclick="cancelOrder('<%= order._id %>')" class="btn btn-outline-danger">Cancel</a>
                    <% } %>
                  </td>
                  <% }else{ %>
                    <td class="column-5">
                      <div class="d-flex flex-row justify-content-between align-items-center align-content-center"
                        id="orderStatusRoad-">
                        <span class="dot-danger"></span>
                        <h5> <span class="badge" style="background-color:rgb(216, 11, 11) ;">Canceled </span></h5>
                      </div>
                    </td>
                    <% } %>

                      </tr>
                      <tr class="">
                        <td class="">On <%= order.createdAt.toDateString() %>
                        </td>
                      </tr>
                      </table>
              </div>
              <% }) %>
                <% } %>







            </div>

          </div>
        </div>


    </div>
    </div>


    <div class="px-lg-5 py-5 mt-5 p-md-5">


      <% if(myOrders.length>0) { %>

        <br><br><br>
        <section class="">
          <div class=" container py-2">
            <div class="row d-flex justify-content-center align-items-center">
              <div class="col">
                <% myOrders.forEach(order=>{ %>
                  <div class="card card-stepper mb-2" style="border-radius: 10px;" id="order">
                    <div class="card-body p-4">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex flex-column">
                          <!-- <span class="lead fw-normal">Your order has been delivered</span> -->
                          <span class="text-muted small bold mb-1">orderId: #<%= order._id %></span>
                          <% order.products.forEach(product=>{%>
                            <span class="text-muted mb-2 "><img src="/productimages/<%= product.productId.Images[0] %>"
                                alt="" width="120px" height="100px">
                              <a href="" class="text-muted ml-5">
                                <%= product.productId.Name %>
                              </a> x <%= product.quantity %> </span>
                            <% }) %>

                              <span class="text-muted small">on <%= order.createdAt.toDateString() %> </span>
                        </div>
                        <div>


                          <button class="btn btn-sm btn-outline-danger" onclick="sweetConfirm" type="button"><i
                              class="bi bi-trash"></i></button>

                        </div>
                      </div>
                      <hr class="my-4">

                      <div class="d-flex flex-row justify-content-between align-items-center align-content-center"
                        id="orderStatusRoad-">
                        <% if(order.status==="pending" ){%>
                          <span class="d-flex justify-content-center align-items-center big-dot dot">
                            <i class="fa fa-check text-white"></i></span>
                          <!-- <hr class="flex-fill"><span class="blank-dot"></span>
                  <hr class="flex-fill"><span class="blank-dot"></span>
                  <hr class="flex-fill"><span class="blank-dot"></span>
                  <hr class="flex-fill"><span class="blank-dot"></span> -->
                          <h5><span class="badge" style="background-color:rgb(201, 14, 77) ;">
                              <%= order.status %>
                            </span></h5>
                          <%}else if(order.status==="Packed" ){ %>
                            <span class="dot"></span>
                            <!-- <hr class="flex-fill track-line"><span class="d-flex justify-content-center align-items-center big-dot dot">  -->
                            <!-- <i class="fa fa-check text-white"></i></span>
                  <hr class="flex-fill"><span class="blank-dot"></span>
                  <hr class="flex-fill"><span class="blank-dot"></span>
                  <hr class="flex-fill"><span class="blank-dot"></span>  -->
                            <h5> <span class="badge" style="background-color:rgb(91, 12, 38) ;">
                                <%= order.status %>
                              </span></h5>
                            <% }else if(order.status==="Shipped" ){ %>
                              <span class="dot"></span>
                              <!-- <hr class="flex-fill track-line"><span class="dot"></span>
                  <hr class="flex-fill track-line"><span class="d-flex justify-content-center align-items-center big-dot dot">
                    <i class="fa fa-check text-white"></i></span>
                  <hr class="flex-fill"><span class="blank-dot"></span>
                  <hr class="flex-fill"><span class="blank-dot"></span>  -->
                              <h5><span class="badge" style="background-color:rgb(244, 138, 0) ;">
                                  <%= order.status %>
                                </span></h5>
                              <% }else if(order.status==="Out for delivery" ){%>
                                <span class="dot"></span>
                                <!-- <hr class="flex-fill track-line"><span class="dot"></span>
                  <hr class="flex-fill track-line"><span class="dot"></span>
                  <hr class="flex-fill track-line"><span class="d-flex justify-content-center align-items-center big-dot dot">
                    <i class="fa fa-check text-white"></i></span>
                  <hr class="flex-fill"><span class="blank-dot"></span>  -->
                                <h5><span class="badge" style="background-color:rgb(77, 1, 255) ;">
                                    <%= order.status %>
                                  </span></h5>
                                <% }else if(order.status==="Delivered" ){%>
                                  <span class="dot"></span>
                                  <!-- <hr class="flex-fill track-line"><span class="dot"></span>
                  <hr class="flex-fill track-line"><span class="dot"></span>
                  <hr class="flex-fill track-line"><span class="dot"></span>
                  <hr class="flex-fill track-line"><span class="d-flex justify-content-center align-items-center big-dot dot">
                    <i class="fa fa-check text-white"></i></span> -->
                                  <h5><span class="badge" style="background-color:rgb(0, 255, 8) ;">
                                      <%= order.status %>
                                    </span></h5>
                                  <%}else{ %>
                                    <span class="dot-danger"></span>
                                    <!-- <hr class="flex-fill track-line-danger"><span class=""></span>
                  <hr class="flex-fill track-line-danger"><span class=""></span>
                  <hr class="flex-fill track-line-danger"><span class=""></span>
                  <hr class="flex-fill track-line-danger"><span class="d-flex justify-content-center align-items-center big-dot-danger dot">
                    <i class="fa-sharp fa-solid fa-xmark"></i></span> -->
                                    <h5> <span class="badge" style="background-color:rgb(177, 39, 85) ;">
                                        <%= order.status %>
                                      </span></h5>
                                    <% } %>


                      </div>

                      <div class="d-flex flex-row justify-content-between align-items-center" id="">
                        <% if(order.status !="Cancelled" ){ %>
                          <div class="d-flex flex-column justify-content-center"><span>Order status</span></div>
                          <!-- <div class="d-flex flex-column justify-content-center align-items-center"><span>Order Packed</span></div>
                  <div class="d-flex flex-column justify-content-center align-items-center"><span>Order Dispatched</span></div>
                  <div class="d-flex flex-column justify-content-center align-items-center"><span>Out for delivery</span></div> -->
                          <!-- <div class="d-flex flex-column align-items-end"><span>Delivered</span></div> -->

                          <% }else{ %>
                            <div class="d-flex flex-column justify-content-center"></div>
                            <div class="d-flex flex-column justify-content-center align-items-center"></div>
                            <div class="d-flex flex-column justify-content-center align-items-center"></div>
                            <div class="d-flex flex-column justify-content-center align-items-center"></div>
                            <div class="d-flex flex-column align-items-end"><span></span></div>
                            <% } %>

                      </div>

                    </div>
                  </div>
                  <% }) %>
              </div>
            </div>
          </div>
        </section>
        <%} else {%>
          <section class="container">
            <div class="text-center py-5">
              <img src="/img/emptycart.png" alt="">
              <div>
                <p class="h4">There is nothing in your orders. Let's shop something.</p>
              </div>
              <a href="/" class="btn btn-primary rounded-pill py-sm-3 px-sm-5">Shop</a>
            </div>
          </section>
          <%}%>
    </div>

    <script>
      function cancelOrder(orderId) {
        Swal.fire({
          title: 'Are you sure?',
          text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#013542',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Yes, ok it!'
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              url: '/cancel-order/' + orderId,
              method: 'post',
              success: (response) => {
                Swal.fire({
                  icon: 'success',
                  title: 'Your order cancelled',
                  showConfirmButton: false,
                  timer: 1500
                })
                // location.reload()

                $('#cartfill').load(location.href + " #cartfill")
              }
            })
          }
        })
      }
    </script>
    <%- include('../include/footer') %>